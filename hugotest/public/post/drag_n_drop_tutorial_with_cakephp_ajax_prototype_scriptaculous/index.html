<!DOCTYPE html>

<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Drag &#39;n drop tutorial with the CakePHP 1.2 Ajax helper, Prototype framework and Scriptaculous library &middot; Dieter Plaetinck&#39;s blog</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<!--[if lt IE 9]>
	<script src="http://localhost:1313//js/html5.js"></script>
	<![endif]-->
    
    <link href="http://localhost:1313//index.xml" rel="alternate" type="application/rss+xml" title="Dieter Plaetinck&#39;s blog" />

    <link rel='stylesheet' id='twentyfourteen-lato-css'  href='//fonts.googleapis.com/css?family=Lato%3A300%2C400%2C700%2C900%2C300italic%2C400italic%2C700italic&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />

    <link rel='stylesheet' id='genericons-css' href='http://localhost:1313//genericons/genericons.css' type='text/css' media='all' />
	<link rel='stylesheet' id='twentyfourteen-style-css' href='http://localhost:1313//css/style.css' type='text/css' media='all' />
	
	<script type='text/javascript' src='http://localhost:1313//js/jquery/jquery.js'></script>
	<script type='text/javascript' src='http://localhost:1313//js/jquery/jquery-migrate.min.js'></script>
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
</head>

<body class="home blog masthead-fixed list-view full-width grid">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<div class="header-main">
			<h1 class="site-title"><a href="http://localhost:1313//index.html" rel="home">Dieter Plaetinck&#39;s blog</a></h1>

			<div class="search-toggle">
				<a href="#search-container" class="screen-reader-text">Search</a>
			</div>

			<nav id="primary-navigation" class="site-navigation primary-navigation" role="navigation">
				<button class="menu-toggle">Primary Menu</button>
				<a class="screen-reader-text skip-link" href="#content">Skip to content</a>
				<div class="nav-menu">
					<ul>
						
						<li class="page_item"> 
							<a href="/">blog</a>
						</li>
						
						<li class="page_item"> 
							<a href="/about/">about</a>
						</li>
						
						<li class="page_item"> 
							<a href="/talks/">talks</a>
						</li>
						
						<li class="page_item"> 
							<a href="https://twitter.com/Dieter_be">tweets</a>
						</li>
						
						<li class="page_item"> 
							<a href="https://github.com/Dieterbe">Github</a>
						</li>
						
					</ul>
				</div>
			</nav>
		</div>

		<div id="search-container" class="search-box-wrapper hide">
			<div class="search-box">
                <script type="text/javascript">
    function site_search(obj) {
    	var host = window.location.host;
        obj.q.value = "site:" + host + " " + obj.ss_q.value;
    }
</script>

<aside id="search-3" class="widget widget_search">
	<form role="search" class="search-form" action="//www.google.com/search" method="get" onSubmit="site_search(this)">

	<input name="q" type="hidden" />
	    <label>
	        <span class="screen-reader-text">Search for:</span>
	        <input name="ss_q" type="text" placeholder="Search ..." class="search-field" />
	    </label>
	    <input type="submit" value="Search" class="search-submit" />
	</form>
</aside>
			</div>
		</div>
	</header>

	<div id="main" class="site-main">


<div id="main-content" class="main-content">

	<div id="primary" class="content-area">
		<div id="content" class="site-content" role="main">

			<article class="post type-post status-publish format-standard hentry">

	
	<header class="entry-header">

	

		<div class="entry-meta">
			<span class="cat-links">
                
			</span>
		</div>

        <h1 class="entry-title"><a href="http://localhost:1313/post/drag_n_drop_tutorial_with_cakephp_ajax_prototype_scriptaculous/">Drag &#39;n drop tutorial with the CakePHP 1.2 Ajax helper, Prototype framework and Scriptaculous library</a></h1>

		<div class="entry-meta">
			<span class="entry-date">
				<a href="http://localhost:1313/post/drag_n_drop_tutorial_with_cakephp_ajax_prototype_scriptaculous/" rel="bookmark">
					<time class="entry-date" datetime="2007-05-29 21:25:13 -0400 EDT">
						May 29, 2007
					</time>
				</a>
			</span>
		</div>

	</header>
	
	<div class="entry-content">
		<p>During the development of my <a href="/masterproef">thesis</a> I wanted to create a drag 'n drop interface.  But I never did anything like that, I never used CakePHP's Ajax helper and neither made I ever use of more advanced functionalities of Scriptaculous/Prototype.  Hell I even never touched Ajax before this! </p>

<p>Although there are some basic CakePHP/Ajax tutorials out there, I still had a hard time because some knowledge about Ajax (in CakePHP) was assumed in all of those.  After a lot of googling I even found a tutorial called <a href="http://www.dustinweber.com/blog/_archives/2007/4/4/2859177.html">CakePHP: Sortable AJAX Drag &amp; Drops - The Basics</a>  <br/>"Perfect!" I thought, until after staring at the article for a long while and I started to notice nowhere in the article "$ajax->drag", "$ajax->drop" or "$ajax->dropRemote" is used.  (those are calls on the CakePHP Ajax helper to enhance objects to become draggable, or to become a dropbox where draggables can be dropped into).  So the only more or less suited tutorial about drag 'n drop was actually about sorting and didn't use the drag/drop function calls at all.  Even though it contains very useful information.</p>

<p>Long story short:  I finally got it working (thanks to Krazylegz and kristofer and possibly others too, it has been a while so I may forget someone ;-), and learned a lot in the process.  I will share what I learned with you guys so that hopefully it's a bit easier for you then what I had to go through.</p>

<h3>Prerequisites</h3>

<p>CakePHP.  I used 1.2 but I think this will work on 1.1 too (because the Ajax helper is in there for a long time.  it's even fully documented in the 1.1 manual)<br />

Scriptaculous &amp; Protoype libraries.  See <a href="http://manual.cakephp.org/chapter/helpers">the cake manual</a> on how to install these.  Don't close this page after installing the libs, because it also explains the possibilities of the Ajax helper and is a reference that you <em>will</em> need!  The <a href="http://api.cakephp.org/1.2/class_ajax_helper.html">api reference</a> reveals even more possibilities, but the former page should do.</p>

<h3>Let's get started!</h3>

<p>Instead of showing a really simple example, I'll give a skeleton example based on a webstore-scenario.  You can have multiple articles (draggables) and 2 droppables: a cart and a thrashbin.  Dropping an article in the cart adds the article to your order (which I usually keep in the session) and updates the view accordingly, dragging it from the cart into the thrashbin removes it from the session and updates the view too.<br />

I've left out the basics such as sql, models and controller business logic, and focused on the Ajax specifics.</p>

<p>The view-code can be combined in different elements but for simplicity let's assume there is only 1 view file.<br />

Keep in mind that each object where you want to assign some functionality to (such as draggable, droppable) must have a unique DOM id.  It doesn't matter if it's a div or span or p or whatever, as long as it has a unique id.</p>

<p>The view looks like this:</p>

<p><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #BC7A00">&lt;![CDATA[</span>

<span style="color: #BC7A00">&lt;?php</span> <span style="color: #008000; font-weight: bold">foreach</span>(<span style="color: #19177C">$articles</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #19177C">$article</span>)<span style="color: #666666">:</span> <span style="color: #BC7A00">?&gt;</span>

<span style="color: #BC7A00">&lt;div id=&quot;&lt;?php</span> <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$article</span>[<span style="color: #BA2121">&#39;Article&#39;</span>][<span style="color: #BA2121">&#39;id&#39;</span>]; <span style="color: #BC7A00">?&gt;&quot;&gt;</span>

<span style="color: #BC7A00">   &lt;?php</span> <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$article</span>[<span style="color: #BA2121">&#39;Article&#39;</span>][<span style="color: #BA2121">&#39;description&#39;</span>]; <span style="color: #BC7A00">?&gt;</span>

<span style="color: #BC7A00">&lt;/div&gt;</span>

<span style="color: #BC7A00">&lt;?php</span> <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$ajax</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drag</span>(<span style="color: #19177C">$article</span>[<span style="color: #BA2121">&#39;Article&#39;</span>][<span style="color: #BA2121">&#39;id&#39;</span>],<span style="color: #008000; font-weight: bold">array</span>(<span style="color: #BA2121">&#39;revert&#39;</span><span style="color: #666666">=&gt;</span><span style="color: #008000; font-weight: bold">true</span>)); <span style="color: #BC7A00">?&gt;</span>

<span style="color: #BC7A00">/*</span>

<span style="color: #BC7A00">   the revert thing will make the draggable return to it&#39;s original position.  Set this to false and the object will stay where you put it.</span>

<span style="color: #BC7A00">   This does not have anything to do with a function call being made btw, that&#39;s the job for the draggables</span>

<span style="color: #BC7A00">*/</span>

<span style="color: #BC7A00">&lt;?php</span> <span style="color: #008000; font-weight: bold">endforeach</span>; <span style="color: #BC7A00">?&gt;</span>





<span style="color: #BC7A00">&lt;div id=&quot;cart&quot;&gt;</span>

<span style="color: #BC7A00">   &lt;?php</span> <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">requestAction</span>(<span style="color: #BA2121">&#39;/controller/showcart&#39;</span>); <span style="color: #BC7A00">?&gt; // this call is not necessary.  You can use it to fill the &lt;div&gt; with some content to start with</span>

<span style="color: #BC7A00">&lt;/div&gt;</span>



<span style="color: #BC7A00">&lt;div id=&quot;thrashbin&quot;&gt;</span>

<span style="color: #BC7A00">&lt;/div&gt;</span>



<span style="color: #BC7A00">&lt;?php</span>

   <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$ajax</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">dropRemote</span>(<span style="color: #BA2121">&#39;cart&#39;</span>,<span style="color: #008000; font-weight: bold">null</span>,<span style="color: #008000; font-weight: bold">array</span>(<span style="color: #BA2121">&#39;url&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;/controller/addarticle/&#39;</span>,<span style="color: #BA2121">&#39;with&#39;</span><span style="color: #666666">=&gt;</span><span style="color: #BA2121">&#39;{draggedid:element.id}&#39;</span>,<span style="color: #BA2121">&#39;update&#39;</span><span style="color: #666666">=&gt;</span><span style="color: #BA2121">&#39;cart&#39;</span>));

   <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$ajax</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">dropRemote</span>(<span style="color: #BA2121">&#39;thrashbin&#39;</span>,<span style="color: #008000; font-weight: bold">null</span>,<span style="color: #008000; font-weight: bold">array</span>(<span style="color: #BA2121">&#39;url&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;/controller/removearticle/&#39;</span>,<span style="color: #BA2121">&#39;with&#39;</span><span style="color: #666666">=&gt;</span><span style="color: #BA2121">&#39;{draggedid:element.id}&#39;</span>,<span style="color: #BA2121">&#39;update&#39;</span><span style="color: #666666">=&gt;</span><span style="color: #BA2121">&#39;cart&#39;</span>));

<span style="color: #BC7A00">?&gt;</span>

<span style="color: #BC7A00">/*</span>

<span style="color: #BC7A00">   these two calls make objects with DOM id&#39;s &#39;cart&#39; and &#39;thrashbin&#39; droppable.  When an object is dropped into them, the actions defined by &#39;url&#39; are called.</span>

<span style="color: #BC7A00">   The &#39;with&#39;=&gt;&#39;{draggedid:element.id} passes the id of the dropped element to the function that is called (on the background, no page refresh or anything like that!).</span>

<span style="color: #BC7A00">   The update thing makes sure that the entire output of the requestAction call is displayed inside the &lt;div id=&quot;cart&quot;&gt;&lt;/div&gt;.</span>

<span style="color: #BC7A00">   So that means that the page will update the part of the page which is specified (dom id &#39;cart&#39;) when the output from the requestAction call is received</span>

<span style="color: #BC7A00">*/</span>

<span style="color: #BC7A00">]]&gt;</span>
</pre></div>
<p></p>

<p>The controller would have functions like this:</p></p>

<p><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #BC7A00">&lt;![CDATA[</span>

<span style="color: #BC7A00">&lt;?php</span>



<span style="color: #408080; font-style: italic">// this function can be used to show initial contents of the cart.</span>

<span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">showcart</span>(){

    <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">set</span>(<span style="color: #BA2121">&#39;articles&#39;</span>,<span style="color: #008000; font-weight: bold">false</span>); <span style="color: #408080; font-style: italic">/* no articles bought yet */</span>

    <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">render</span>(<span style="color: #BA2121">&#39;cart&#39;</span>);

    <span style="color: #408080; font-style: italic">// (read on to find out more about this view)</span>

}



<span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">addarticle</span>(){

<span style="color: #408080; font-style: italic">/*</span>

<span style="color: #408080; font-style: italic">   The DOM id of the element that has been dragged into here can be found in $this-&gt;params[&#39;form&#39;][&#39;draggedid&#39;].</span>

<span style="color: #408080; font-style: italic">   You can use that id to do something like $this-&gt;Article-&gt;findById() to add the article to the session.</span>

<span style="color: #408080; font-style: italic">   At the end of this function the entire contents of the &lt;strong&gt;view&lt;/strong&gt; file will be returned (and rendered inside the &lt;div&gt; with DOM id &#39;cart&#39;.)</span>

<span style="color: #408080; font-style: italic">   The layout won&#39;t be rendered, only the view, since this is an Ajax call (the difference is autodetected by Cakes RequestHandler) </span>

<span style="color: #408080; font-style: italic">   You could do something like this:</span>

<span style="color: #408080; font-style: italic">*/</span>

   <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">set</span>(<span style="color: #BA2121">&#39;articles&#39;</span>, <span style="color: #19177C">$all_bought_articles_from_the_session</span>);

   <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">render</span>(<span style="color: #BA2121">&#39;cart&#39;</span>);

}



<span style="color: #408080; font-style: italic">// this function is similar to the one above but instead removes one article from the session and renders the same view ;-)</span>

<span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">removearticle</span>(){

}

<span style="color: #BC7A00">?&gt;</span>

<span style="color: #BC7A00">]]&gt;</span>
</pre></div>
<p></p>

<p>The view controller/cart.ctp could look something like this:</p></p>

<p><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #BC7A00">&lt;![CDATA[</span>

<span style="color: #BC7A00">&lt;ul&gt;</span>

<span style="color: #BC7A00">&lt;?php</span> <span style="color: #008000; font-weight: bold">foreach</span>(<span style="color: #19177C">$articles</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #19177C">$artikel</span>)<span style="color: #666666">:</span><span style="color: #BC7A00">?&gt;</span>

<span style="color: #BC7A00">&lt;li&gt;&lt;?php</span> <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$article</span>[<span style="color: #BA2121">&#39;Article&#39;</span>][<span style="color: #BA2121">&#39;id&#39;</span>]; <span style="color: #BC7A00">?&gt;&lt;/li&gt;</span>

<span style="color: #BC7A00">&lt;?php</span> <span style="color: #008000; font-weight: bold">endforeach</span>; <span style="color: #BC7A00">?&gt;</span>

<span style="color: #BC7A00">&lt;/ul&gt;</span>



<span style="color: #BC7A00">&lt;?php</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span><span style="color: #19177C">$articles</span>) <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;No articles in the cart!&quot;</span>; <span style="color: #BC7A00">?&gt;</span>

<span style="color: #BC7A00">]]&gt;</span>
</pre></div>
<p></p>

<p>There you have it.  All explanations are inside the sources, I hope it&rsquo;s clear enough.  If not, just ask :-)</p></p>

<h3>Common misconceptions</h3>

<p>From reading many (outdated?) articles about Ajax in cake I noted a lot of information that was not correct.  Here they are:</p>

<ul>

<li>It is <em>not</em> necessary to explicity pass the 'ajax' layout as an argument to the render call.  Eg you don't need to do this:  $this->render('cart', 'ajax');  You can do $this->render('cart'); (or even no explicit render call at all, if the view file is the same as the action name of your controller) Cakes RequestHandler automatically detects when it's dealing with an ajax call, and in that case won't render the layout, only the view.</li>

<li>It is <em>not</em> necessary to declare the UTF-8 character encoding in your layout or view</li>

<li>You <em>don't</em> need $this->autoRender =false; in the controller.  Unless maybe you absolutely don't want to render anything.</li>

</ul>

<h3>The end</h3>

<p>There you have it.  I hope everything is clear.  If not, ask on !</p>

<p>For those who don't have it already, I really recommend <a href="http://www.getfirebug.com/">The firebug firefox extension</a>.  Not only is it a great aid when designing, it's also perfectly suited for debugging Ajax calls.  It can show you exactly what happens when you drag an item in a droppable, what request is being made, what is being returned, etc.<br />

This is explained in this movie:<a href="http://www.youtube.com/watch?v=W4jXAaEMp2M">Introduction to Debugging AJAX Application with Firebug</a></p>

	</div>

	<footer class="entry-meta">
		<span class="tag-links">		
			
                <a href="http://localhost:1313//tags/php/index.html" rel="tag">php</a>
            
                <a href="http://localhost:1313//tags/cakephp/index.html" rel="tag">cakephp</a>
            
		</span>
	</footer>
</article> 


			
		
		</div>

	</div>
	<div id="secondary">

	

	<div id="primary-sidebar" class="primary-sidebar widget-area" role="complementary">

        

        

		<aside id="categories-3" class="widget widget_categories">


    
     


    <br/>
	<h1 class="widget-title">Popular tags</h1>

    <a href="http://localhost:1313/tags/monitoring">monitoring</a>
    25
    <br/>
    <a href="http://localhost:1313/tags/devops">devops</a>
    23
    <br/>
    <a href="http://localhost:1313/tags/golang">golang</a>
    8
    <br/>
    <br/>
    <br/>

	<h1 class="widget-title">Other tags</h1>

    
        
            <a href="http://localhost:1313/tags/arch">arch</a>
            19
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/bash">bash</a>
            15
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/cakephp">cakephp</a>
            8
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/conf">conf</a>
            9
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/dauth">dauth</a>
            1
            <br/>
        
    
        
        
    
        
            <a href="http://localhost:1313/tags/drums">drums</a>
            1
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/drupal">drupal</a>
            5
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/foss">foss</a>
            45
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/git">git</a>
            3
            <br/>
        
    
        
        
    
        
            <a href="http://localhost:1313/tags/information-age">information-age</a>
            3
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/life">life</a>
            33
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/linux">linux</a>
            20
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/lua">lua</a>
            1
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/mail">mail</a>
            1
            <br/>
        
    
        
        
    
        
            <a href="http://localhost:1313/tags/music">music</a>
            5
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/mysql">mysql</a>
            3
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/n900">n900</a>
            2
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/netlog">netlog</a>
            6
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/openstack">openstack</a>
            1
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/perf">perf</a>
            10
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/photos">photos</a>
            3
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/php">php</a>
            11
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/productivity">productivity</a>
            6
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/python">python</a>
            5
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/real-life">real-life</a>
            2
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/thesis">thesis</a>
            3
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/travel">travel</a>
            2
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/uzbl">uzbl</a>
            6
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/vimeo">vimeo</a>
            3
            <br/>
        
    
        
            <a href="http://localhost:1313/tags/web2.0">web2.0</a>
            9
            <br/>
        
    
</aside>


	</div>

</div>

</div>

		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">

			<div class="site-info">
				<a href="http://gohugo.io">Proudly powered by Hugo</a>
			</div>
		</footer>
	</div>

	<script type='text/javascript' src='http://localhost:1313//js/functions.js'></script>
<script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>