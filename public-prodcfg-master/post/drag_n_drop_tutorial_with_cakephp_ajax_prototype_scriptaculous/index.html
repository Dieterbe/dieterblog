<!DOCTYPE html>

<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Drag &#39;n drop tutorial with the CakePHP 1.2 Ajax helper, Prototype framework and Scriptaculous library &middot; Dieter&#39;s blog</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<!--[if lt IE 9]>
	<script src="http://dieter.plaetinck.be/js/html5.js"></script>
	<![endif]-->

    <link href="http://dieter.plaetinck.be/index.xml" rel="alternate" type="application/rss+xml" title="Dieter&#39;s blog" />

    <link rel='stylesheet' id='twentyfourteen-lato-css'  href='http://fonts.googleapis.com/css?family=Lato%3A300%2C400%2C700%2C900%2C300italic%2C400italic%2C700italic&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />

    <link rel='stylesheet' id='genericons-css' href='http://dieter.plaetinck.be/genericons/genericons.css' type='text/css' media='all' />
	<link rel='stylesheet' id='twentyfourteen-style-css' href='http://dieter.plaetinck.be/css/style.css' type='text/css' media='all' />
	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1455070-1', 'auto');
  ga('send', 'pageview');
</script>
</head>

<body class="home blog masthead-fixed list-view full-width grid">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<div class="header-main">
			<h1 class="site-title"><a href="http://dieter.plaetinck.be" rel="home">Dieter&#39;s blog</a></h1>

			<div class="search-toggle">
				<a href="#search-container" class="screen-reader-text">Search</a>
			</div>

			<nav id="primary-navigation" class="site-navigation primary-navigation" role="navigation">
				<button class="menu-toggle">Primary Menu</button>
				<a class="screen-reader-text skip-link" href="#content">Skip to content</a>
				<div class="nav-menu">
					<ul>
						
						<li class="page_item">
							<a href="/">blog</a>
						</li>
						
						<li class="page_item">
							<a href="/about">about</a>
						</li>
						
						<li class="page_item">
							<a href="/talks">talks</a>
						</li>
						
						<li class="page_item">
							<a href="https://twitter.com/Dieter_be">tweets</a>
						</li>
						
						<li class="page_item">
							<a href="https://github.com/Dieterbe">Github</a>
						</li>
						
					</ul>
				</div>
			</nav>
		</div>

		<div id="search-container" class="search-box-wrapper hide">
			<div class="search-box">
                <script type="text/javascript">
    function site_search(obj) {
    	var host = window.location.host;
        obj.q.value = "site:" + host + " " + obj.ss_q.value;
    }
</script>

<aside id="search-3" class="widget widget_search">
	<form role="search" class="search-form" action="//www.google.com/search" method="get" onSubmit="site_search(this)">

	<input name="q" type="hidden" />
	    <label>
	        <span class="screen-reader-text">Search for:</span>
	        <input name="ss_q" type="text" placeholder="Search ..." class="search-field" />
	    </label>
	    <input type="submit" value="Search" class="search-submit" />
	</form>
</aside>
			</div>
		</div>
	</header>

	<div id="main" class="site-main">


<div id="main-content" class="main-content">

	<div id="primary" class="content-area">
		<div id="content" class="site-content" role="main">

			<article class="post type-post status-publish format-standard hentry">

	
	<header class="entry-header">

	

		<div class="entry-meta">
			<span class="cat-links">
                
			</span>
		</div>

        <h1 class="entry-title"><a href="http://dieter.plaetinck.be/post/drag_n_drop_tutorial_with_cakephp_ajax_prototype_scriptaculous/">Drag &#39;n drop tutorial with the CakePHP 1.2 Ajax helper, Prototype framework and Scriptaculous library</a></h1>

		<div class="entry-meta">
			<span class="entry-date">
				<a href="http://dieter.plaetinck.be/post/drag_n_drop_tutorial_with_cakephp_ajax_prototype_scriptaculous/" rel="bookmark">
					<time class="entry-date" datetime="2007-05-29T21:25:13-04:00">
						May 29, 2007
					</time>
				</a>
			</span>
		</div>

	</header>

	<div class="entry-content">
		<h3>Prerequisites</h3>
<p>CakePHP.  I used 1.2 but I think this will work on 1.1 too (because the Ajax helper is in there for a long time.  it's even fully documented in the 1.1 manual)<br />
Scriptaculous &amp; Protoype libraries.  See <a href="http://manual.cakephp.org/chapter/helpers">the cake manual</a> on how to install these.  Don't close this page after installing the libs, because it also explains the possibilities of the Ajax helper and is a reference that you <em>will</em> need!  The <a href="http://api.cakephp.org/1.2/class_ajax_helper.html">api reference</a> reveals even more possibilities, but the former page should do.</p>
<h3>Let's get started!</h3>
<p>Instead of showing a really simple example, I'll give a skeleton example based on a webstore-scenario.  You can have multiple articles (draggables) and 2 droppables: a cart and a thrashbin.  Dropping an article in the cart adds the article to your order (which I usually keep in the session) and updates the view accordingly, dragging it from the cart into the thrashbin removes it from the session and updates the view too.<br />
I've left out the basics such as sql, models and controller business logic, and focused on the Ajax specifics.</p>
<p>The view-code can be combined in different elements but for simplicity let's assume there is only 1 view file.<br />
Keep in mind that each object where you want to assign some functionality to (such as draggable, droppable) must have a unique DOM id.  It doesn't matter if it's a div or span or p or whatever, as long as it has a unique id.</p>
<p>The view looks like this:</p>
{{< highlight "html+php" "style=default" >}}
<?php foreach($articles as $article): ?>
<div id="<?php echo $article['Article']['id']; ?>">
   <?php echo $article['Article']['description']; ?>
</div>
<?php echo $ajax->drag($article['Article']['id'],array('revert'=>true)); ?>
/*
   the revert thing will make the draggable return to it's original position.  Set this to false and the object will stay where you put it.
   This does not have anything to do with a function call being made btw, that's the job for the draggables
*/
<?php endforeach; ?>


<div id="cart">
   <?php echo $this->requestAction('/controller/showcart'); ?> // this call is not necessary.  You can use it to fill the <div> with some content to start with
</div>

<div id="thrashbin">
</div>

<?php
   echo $ajax->dropRemote('cart',null,array('url' => '/controller/addarticle/','with'=>'{draggedid:element.id}','update'=>'cart'));
   echo $ajax->dropRemote('thrashbin',null,array('url' => '/controller/removearticle/','with'=>'{draggedid:element.id}','update'=>'cart'));
?>
/*
   these two calls make objects with DOM id's 'cart' and 'thrashbin' droppable.  When an object is dropped into them, the actions defined by 'url' are called.
   The 'with'=>'{draggedid:element.id} passes the id of the dropped element to the function that is called (on the background, no page refresh or anything like that!).
   The update thing makes sure that the entire output of the requestAction call is displayed inside the <div id="cart"></div>.
   So that means that the page will update the part of the page which is specified (dom id 'cart') when the output from the requestAction call is received
*/
{{< /highlight >}}<p>
The controller would have functions like this:</p>
{{< highlight "html+php" "style=default" >}}
<?php

// this function can be used to show initial contents of the cart.
function showcart(){
    $this->set('articles',false); /* no articles bought yet */
    $this->render('cart');
    // (read on to find out more about this view)
}

function addarticle(){
/*
   The DOM id of the element that has been dragged into here can be found in $this->params['form']['draggedid'].
   You can use that id to do something like $this->Article->findById() to add the article to the session.
   At the end of this function the entire contents of the <strong>view</strong> file will be returned (and rendered inside the <div> with DOM id 'cart'.)
   The layout won't be rendered, only the view, since this is an Ajax call (the difference is autodetected by Cakes RequestHandler) 
   You could do something like this:
*/
   $this->set('articles', $all_bought_articles_from_the_session);
   $this->render('cart');
}

// this function is similar to the one above but instead removes one article from the session and renders the same view ;-)
function removearticle(){
}
?>
{{< /highlight >}}<p>
The view controller/cart.ctp could look something like this:</p>
{{< highlight "html+php" "style=default" >}}
<ul>
<?php foreach($articles as $artikel):?>
<li><?php echo $article['Article']['id']; ?></li>
<?php endforeach; ?>
</ul>

<?php if(!$articles) echo "No articles in the cart!"; ?>
{{< /highlight >}}<p>
There you have it.  All explanations are inside the sources, I hope it's clear enough.  If not, just ask :-)</p>
<h3>Common misconceptions</h3>
<p>From reading many (outdated?) articles about Ajax in cake I noted a lot of information that was not correct.  Here they are:</p>
<ul>
<li>It is <em>not</em> necessary to explicity pass the 'ajax' layout as an argument to the render call.  Eg you don't need to do this:  $this->render('cart', 'ajax');  You can do $this->render('cart'); (or even no explicit render call at all, if the view file is the same as the action name of your controller) Cakes RequestHandler automatically detects when it's dealing with an ajax call, and in that case won't render the layout, only the view.</li>
<li>It is <em>not</em> necessary to declare the UTF-8 character encoding in your layout or view</li>
<li>You <em>don't</em> need $this->autoRender =false; in the controller.  Unless maybe you absolutely don't want to render anything.</li>
</ul>
<h3>The end</h3>
<p>There you have it.  I hope everything is clear.  If not, ask on !</p>
<p>For those who don't have it already, I really recommend <a href="http://www.getfirebug.com/">The firebug firefox extension</a>.  Not only is it a great aid when designing, it's also perfectly suited for debugging Ajax calls.  It can show you exactly what happens when you drag an item in a droppable, what request is being made, what is being returned, etc.<br />
This is explained in this movie:<a href="http://www.youtube.com/watch?v=W4jXAaEMp2M">Introduction to Debugging AJAX Application with Firebug</a></p>

	</div>

	<footer class="entry-meta">
		<span class="tag-links">
			
                <a href="http://dieter.plaetinck.be/tags/php" rel="tag">php</a>
            
                <a href="http://dieter.plaetinck.be/tags/cakephp" rel="tag">cakephp</a>
            
		</span>
		
		<style>
.honey {
display: none;
}
</style>

<form id="comments-form" class="comments__new" action="http://plaetinck.be:5888/comments">
    <input type="hidden" name="post" value="drag_n_drop_tutorial_with_cakephp_ajax_prototype_scriptaculous">
    <input type="text" name="company" class="honey">
    <br/><input type="text" name="name" placeholder="Name" required/>
    <br/><input type="email" name="email" placeholder="Email address (will not be public)" required/>
    <br/><input type="url" name="url" placeholder="Website (optional)"/>
    <textarea rows="10" name="message" placeholder="Comment" required></textarea>
    <input type="submit" value="Send" />
</form>

<script type="text/template" id="template--new-comment">
	<article id="comment" class="comment">
		<img class="commentAvatar" src="https://www.gravatar.com/avatar/@hash?d=mm&s=80">
		<div class="commentRight">
			<p class="commentAuthor"><a href="@url" class="commentAuthor">@name</a></p>
			<time class="entry-date" datetime="2007-05-29T21:25:13-04:00">@date</time>
			<div class="commentMessage">@message</div>
		</div>
	</article>
</script>

<script language="javascript">
var monthNames = ["January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"
];

var addComment = function (data) {
     var template = document.getElementById('template--new-comment').innerHTML;
     var d = new Date(data.Ts);
     var date = d.getDate() + " " + monthNames[d.getMonth()] + ", " + d.getFullYear() + " at " + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
     template = template.replace('@hash', data.Hash)
                        .replace('@date', date)
                        .replace('@name', data.Author)
                        .replace('@message', data.Message)
                        .replace('@url', data.Link)
     $(template).insertBefore('.comments__new');
};

var addComments = function(data) {
	$.each(data, function(i, c) {
		addComment(c);
	});
};

$( document ).ready(function() {
     $.ajax({
         method: "GET",
         url: "http:\/\/plaetinck.be:5888\/comments/drag_n_drop_tutorial_with_cakephp_ajax_prototype_scriptaculous",
         success: addComments,
				 error: function(jqXHR, status, err) {
					 e = "<div><b>Could not load comments</b></br>" + status + " " + err +
						 "<br/>Disabling commenting feature.<br/>Pretty sure Dieter monitors his site using <a href='https://grafana.net/plugins/raintank-worldping-app'>WorldPing</a> but maybe this is a transient error.</div>";
					$(e).insertBefore('.comments__new');
					 $("#comments-form").hide();
				 }
     });
			$('#comments-form').submit(function (event) {
					var url = $(this).attr('action');
					var data = $(this).serialize();
					var formName = $(this).find('[name="name"]').val().trim();
					var formUrl = $(this).find('[name="url"]').val().trim();
					var formEmail = $(this).find('[name="email"]').val().trim();

					$.ajax({
							method: "POST",
							url: url,
							data: data,
							success: addComment,
							error: function(jqXHR, status, err) {
								alert("sorry: "+ status + " " + err +", would you be so kind to let me know about this error?")
							}
					});
					return false;
			});
});

</script>

		
	</footer>
</article> 


			
		
		</div>

	</div>
	<div id="secondary">

	

	<div id="primary-sidebar" class="primary-sidebar widget-area" role="complementary">

        

        

		<aside id="categories-3" class="widget widget_categories">


    
     


    <br/>
	<h1 class="widget-title">Popular tags</h1>

    <a href="http://dieter.plaetinck.be/tags/monitoring">monitoring</a>
    27
    <br/>
    <a href="http://dieter.plaetinck.be/tags/devops">devops</a>
    24
    <br/>
    <a href="http://dieter.plaetinck.be/tags/golang">golang</a>
    11
    <br/>
    <br/>
    <br/>

	<h1 class="widget-title">Other tags</h1>

    
        
            <a href="http://dieter.plaetinck.be/tags/arch">arch</a>
            19
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/bash">bash</a>
            15
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/cakephp">cakephp</a>
            8
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/conf">conf</a>
            9
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/dauth">dauth</a>
            1
            <br/>
        
    
        
        
    
        
            <a href="http://dieter.plaetinck.be/tags/drums">drums</a>
            1
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/drupal">drupal</a>
            5
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/foss">foss</a>
            45
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/git">git</a>
            4
            <br/>
        
    
        
        
    
        
            <a href="http://dieter.plaetinck.be/tags/information-age">information-age</a>
            3
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/life">life</a>
            33
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/linux">linux</a>
            20
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/lua">lua</a>
            1
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/mail">mail</a>
            1
            <br/>
        
    
        
        
    
        
            <a href="http://dieter.plaetinck.be/tags/music">music</a>
            5
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/mysql">mysql</a>
            3
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/n900">n900</a>
            2
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/netlog">netlog</a>
            6
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/openstack">openstack</a>
            1
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/perf">perf</a>
            10
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/photos">photos</a>
            3
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/php">php</a>
            11
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/productivity">productivity</a>
            6
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/programming">programming</a>
            1
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/python">python</a>
            5
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/real-life">real-life</a>
            2
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/thesis">thesis</a>
            3
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/travel">travel</a>
            2
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/uzbl">uzbl</a>
            6
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/vimeo">vimeo</a>
            3
            <br/>
        
    
        
            <a href="http://dieter.plaetinck.be/tags/web2.0">web2.0</a>
            9
            <br/>
        
    
</aside>


	</div>

</div>

</div>

		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">

			<div class="site-info">
				<a href="http://gohugo.io">Proudly powered by Hugo</a>
			</div>
		</footer>
	</div>

	<script type='text/javascript' src='http://dieter.plaetinck.be/js/functions.js'></script>
</body>
</html>