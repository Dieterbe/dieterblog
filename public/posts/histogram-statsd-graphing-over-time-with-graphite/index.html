<!DOCTYPE html>
<html lang="en-us"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<title itemprop="name">Histograms in statsd, and graphing them over time with graphite. | Dieter&#39;s blog</title>

<meta property="og:title" content="Histograms in statsd, and graphing them over time with graphite. | Dieter&#39;s blog" />
<meta name="twitter:title" content="Histograms in statsd, and graphing them over time with graphite. | Dieter&#39;s blog" />
<meta itemprop="name" content="Histograms in statsd, and graphing them over time with graphite. | Dieter&#39;s blog" />
<meta name="application-name" content="Histograms in statsd, and graphing them over time with graphite. | Dieter&#39;s blog" />
<meta property="og:site_name" content="" />

<meta name="description" content="">
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />



  <meta itemprop="image" content="http://localhost:1313" />
  <meta property="og:image" content="http://localhost:1313" />
  <meta name="twitter:image" content="http://localhost:1313" />
  <meta name="twitter:image:src" content="http://localhost:1313" />




    
    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2012-11-07T18:45:11-0400 />
    <meta property="article:published_time" content=2012-11-07T18:45:11-0400 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Histograms in statsd, and graphing them over time with graphite.",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2012-11-07",
        "description": "",
        "wordCount":  956 ,
        "mainEntityOfPage": "True",
        "dateModified": "2012-11-07",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "Dieter\u0027s blog"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.122.0">

    

    <link rel="canonical" href="http://localhost:1313/posts/histogram-statsd-graphing-over-time-with-graphite/">
    <link href="/style.min.18927ce2d0dc33c991e188f9b4efd25929b9589151125f809e2b3f45e447e971.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    </head>
<body data-theme = "" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/projects/">
                        Projects
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/about/">
                        About
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/talks/">
                        Talks
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Histograms in statsd, and graphing them over time with graphite.</h1>
                
                
                <div class="post-meta">
                    <time datetime="2012-11-07T18:45:11-04:00" itemprop="datePublished"> 7 Nov 2012 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p>
I submitted a pull request to statsd which adds <a href="https://github.com/etsy/statsd/pull/162">histogram support</a>.
<img style="float:left;margin:0 5px 0 0;" src="/files/Black_cherry_tree_histogram.svg.png" alt="Example histogram, from Wikipedia"/>
<br/>(refresher: a histogram is [a visualization of] a frequency distribution of data,
paraphrasing your data by keeping frequencies for entire classes (ranges of data).
<a href="http://en.wikipedia.org/wiki/Histogram">histograms - Wikipedia</a>)
<br/>It's commonly documented how to plot single histograms, that is a 2D diagram consisting of rectangles whose
<ul>
<li>area is proportional to the frequency of a variable</li>
<li>whose width is equal to the class interval</li>
</ul>
Class intervals go on x-axis, frequencies on y-axis.
<br/>
<br/>
Note: histogram class intervals are supposed to have the same width.
<br/>My implementation allows arbitrary class intervals with potentially different widths,
as well as an upper boundary of infinite.
</p>
<h4>Plotting histograms.. over time</h4>
<p>
We want to plot histograms over time, and not just for a few select points in time (in which case you can just make several histograms),
but a contiguous range of time, preferably through graphite's 2D graphs cause graphite is neat and common enough.
<br/>Time goes on x-axis, that's pretty much a given.  So I'm trying to explore ways to visualize both class intervals as well as frequencies on the y-axis.
</p>
<p>The example I'll use are page rendering timings, condensed into classes with upper boundaries of 0.01, 0.05, 0.1, 0.5, 1, 5, 10, 50 and infinite seconds</p>
<p>
Tips and notes:
<ul>
<li>
the histogram implementation stores absolute frequencies, but it's easy to get relative frequencies in percent, like so:
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>target=scale(divideSeries(stats.timers.&lt;your_metric&gt;.bin_*,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>)</span></span></code></pre></div>
</li>
<li>I'll be using relative frequencies here because it normalizes the scale of the y-axis</li>
<li>In this use case each class has a notion of desirability (<i>low render time good, high render time bad</i>),
<br/>I think it makes sense to use color to represent this.  This extends to a lot of operational metrics which one would be using histograms for.
<br/>(unlike non-software histograms that represent demographics or tree heights, where classes usually have nothing to do with desirability or quality).
<br/>As it turns out, it's fairly easy to programmatically compute colors between green and red in order to have mathematically correct "steps" of color.
<br/>However, <a href="http://stackoverflow.com/questions/340209/generate-colors-between-red-and-green-for-a-power-meter">Looks like HSV values are more suited
than RGB</a> but <a href="https://github.com/graphite-project/graphite-web/issues/93">
graphite doesn't support HSV (yet)</a> (although one could convert HSV to RGB).
Also <a href="http://vis4.net/blog/posts/goodbye-redgreen-scales/">it looks like
green-purple would be a better choice for people with color blindness</a>.  I haven't gone too far in this topic.
</li>
<li>Since I choose to go with color gradients, it means I better use stacked graphs, otherwise it would be too hard to distinguish which graph is what</li>
<li>None of this is restricted to timing data.  The metric type under which histograms are (and should be) implemented is called "timing", which is
a misleading name but <a href="https://github.com/etsy/statsd/issues/98">we're working on renaming it</a>.</li>
</ul>


<h4>First version</h4>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>http:<span style="color:#007f7f">//localhost:9000/render/?height=300&amp;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>width=<span style="color:#ff0;font-weight:bold">740</span>&amp;from=-<span style="color:#ff0;font-weight:bold">24</span>h&amp;title=Render time histogram&amp;
</span></span><span style="display:flex;"><span>vtitle=relative frequency <span style="color:#fff;font-weight:bold">in</span> %&amp;yMax=<span style="color:#ff0;font-weight:bold">100</span>&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_01,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;2FFF00&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.01&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_05,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;64DD0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.05&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_1,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;9CDD0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.1&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_5,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;DDCC0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.5&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_1,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;DDB70E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;1&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_5,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;FF6200&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;5&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_10,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;FF3C00&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;10&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_50,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;FF1E00&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;50&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_inf,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;FF0000&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;inf&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>lineMode=slope&amp;areaMode=stacked&amp;drawNullAsZero=<span style="color:#fff;font-weight:bold">false</span>&amp;hideLegend=<span style="color:#fff;font-weight:bold">false</span></span></span></code></pre></div>
<img src="/files/rendertime-histogram.png" width="740" height="300" alt="rendertime histogram" />
<br/>Turns out we mainly see the vast majority that performs well, simply because with this way of rendering,
the higher the frequency of a class, the more prominent.  Bad values are hard to see because there's not many of them,
despite being more interesting.
A thought I had at this point was to make all "class bands" equally wide and use a green-to-red gradient to denote the frequency values,
or even just keep the current color assignments but rely on something like opacity to express frequencies. Alas, none of this is currently
possible with graphite, as far as I can tell.  Though I would like to explore this further.  Especially because I think it wouldn't be hard to implement
in graphite.
<br/>
<br/>
So, let's see what <i>can</i> be done right now.

<h4>Leaving out the smallest class</h4>
This adaption is basically the same as before, but leaves out the smallest class (which took most space), this way
the other bands are a bit more visible but the effect isn't as clear as we want.
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>http:<span style="color:#007f7f">//localhost:9000/render/?height=300&amp;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>width=<span style="color:#ff0;font-weight:bold">740</span>&amp;from=-<span style="color:#ff0;font-weight:bold">24</span>h&amp;title=Render time histogram&amp;
</span></span><span style="display:flex;"><span>vtitle=relative frequency <span style="color:#fff;font-weight:bold">in</span> %, leaving out first <span style="color:#fff;font-weight:bold">class</span>&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_05,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;64DD0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.05&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_1,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;9CDD0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.1&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_5,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;DDCC0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.5&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_1,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;DDB70E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;1&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_5,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;FF6200&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;5&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_10,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;FF3C00&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;10&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_50,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;FF1E00&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;50&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_inf,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">100</span>),<span style="color:#0ff;font-weight:bold">&#39;FF0000&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;inf&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>lineMode=slope&amp;areaMode=stacked&amp;drawNullAsZero=<span style="color:#fff;font-weight:bold">false</span>&amp;hideLegend=<span style="color:#fff;font-weight:bold">false</span></span></span></code></pre></div>
<img src="/files/rendertime-histogram-leaving-out-first-class.png" width="740" height="300" alt="rendertime histogram leaving out first class" />

<h4>Per-band scaling</h4>
Finally, the bigger the values represented by each class the more we inflate the band,
so the more problematic cases become more visible, despite having a lower frequency.
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>http:<span style="color:#007f7f">//localhost:9000/render/?height=300&amp;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>width=<span style="color:#ff0;font-weight:bold">740</span>&amp;from=-<span style="color:#ff0;font-weight:bold">24</span>h&amp;title=Render time histogram&amp;
</span></span><span style="display:flex;"><span>vtitle=rel. freq <span style="color:#fff;font-weight:bold">with</span> scale adjustment per band&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_01,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">0.01</span>),<span style="color:#0ff;font-weight:bold">&#39;2FFF00&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.01&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_05,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">0.04</span>),<span style="color:#0ff;font-weight:bold">&#39;64DD0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.05&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_1,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">0.05</span>),<span style="color:#0ff;font-weight:bold">&#39;9CDD0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.1&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_0_5,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">0.4</span>),<span style="color:#0ff;font-weight:bold">&#39;DDCC0E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;0.5&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_1,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">0.5</span>),<span style="color:#0ff;font-weight:bold">&#39;DDB70E&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;1&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_5,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">4</span>),<span style="color:#0ff;font-weight:bold">&#39;FF6200&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;5&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_10,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">5</span>),<span style="color:#0ff;font-weight:bold">&#39;FF3C00&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;10&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_50,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">40</span>),<span style="color:#0ff;font-weight:bold">&#39;FF1E00&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;50&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>target=alias(color(scale(divideSeries(stats.timers.render_time.bin_inf,stats.timers.render_time.count),<span style="color:#ff0;font-weight:bold">60</span>),<span style="color:#0ff;font-weight:bold">&#39;FF0000&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;inf&#39;</span>)&amp;
</span></span><span style="display:flex;"><span>lineMode=slope&amp;areaMode=stacked&amp;drawNullAsZero=<span style="color:#fff;font-weight:bold">false</span>&amp;hideLegend=<span style="color:#fff;font-weight:bold">false</span></span></span></code></pre></div>
<img src="/files/rendertime-histogram-higher-focus-for-higher-class-interval.png" width="740" height="300" alt="rendertime histogram with higher focus for higher class interval" />
<br/>I started off by scaling each band by the width of the class interval.  This is actually more arbitrary than it may seem.
<br/>The point is that now it's easier to spot acute as well as long-standing problems, but note you can't really read statistics from this graph because of the per-band scaling.
<br/>Note also that outliers contribute to the outer band(s) and are given as much focus as non-outliers in the same bands.
In a system over which you have no complete control (i.e. if you were graphing histograms of time until first byte or page loaded at client,
where you rely on the internet as a transport) it makes sense to give less attention to outliers and focus on optimizing for as many users as possible,
I think it there's no reliable way to subtract outliers from the upper bands and you should also graph averages and percentiles and understand what each
graph does.
But anyway here I want to include outliers, because they represent latencies we can fix.

<h4>Final notes</h4>
While the tools we have are by no means perfect, I'm seeing gradual improvement in the monitoring space.  This work is only a small piece
of the puzzle. The rendering of histograms can be improved but at this point I think they are good enough to be usable. The real challenge is
putting in place automated trending, anomaly detection and alerting.  If we can figure that out, there's less need to be looking at graphs in the first place.

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/Dieterbe" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://twitter.com/Dieter_be" target="_blank" rel="noopener noreferrer me"
    title="Twitter">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
</a>
<a href="https://linkedin.com/in/dieterplaetinck" target="_blank" rel="noopener noreferrer me"
    title="LinkedIn">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
</a>
</div>
    <small class="footer_copyright">
        All content © Dieter Plaetinck, available under
        <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noreferrer noopener">CC BY 4.0</a>
    </small>

</footer>







    
    <script src="http://localhost:1313/js/main.min.4ee188e1744c19816e95a540b2650ed9f033ea0371e74eac8e717355cfca8741.js" integrity="sha256-TuGI4XRMGYFulaVAsmUO2fAz6gNx506sjnFzVc/Kh0E="></script>

    

</body>
</html>
