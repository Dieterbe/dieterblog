<!DOCTYPE html>
<html lang="en-us"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<title itemprop="name">Influx-cli: a commandline interface to Influxdb. | Dieter&#39;s blog</title>

<meta property="og:title" content="Influx-cli: a commandline interface to Influxdb. | Dieter&#39;s blog" />
<meta name="twitter:title" content="Influx-cli: a commandline interface to Influxdb. | Dieter&#39;s blog" />
<meta itemprop="name" content="Influx-cli: a commandline interface to Influxdb. | Dieter&#39;s blog" />
<meta name="application-name" content="Influx-cli: a commandline interface to Influxdb. | Dieter&#39;s blog" />
<meta property="og:site_name" content="" />

<meta name="description" content="">
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />



  <meta itemprop="image" content="http://localhost:1313" />
  <meta property="og:image" content="http://localhost:1313" />
  <meta name="twitter:image" content="http://localhost:1313" />
  <meta name="twitter:image:src" content="http://localhost:1313" />




    
    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2014-09-08T08:36:36-0400 />
    <meta property="article:published_time" content=2014-09-08T08:36:36-0400 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Influx-cli: a commandline interface to Influxdb.",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2014-09-08",
        "description": "",
        "wordCount":  649 ,
        "mainEntityOfPage": "True",
        "dateModified": "2014-09-08",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "Dieter\u0027s blog"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.122.0">

    

    <link rel="canonical" href="http://localhost:1313/posts/influx-cli_a_commandline_interface_to_influxdb/">
    <link href="/style.min.18927ce2d0dc33c991e188f9b4efd25929b9589151125f809e2b3f45e447e971.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    </head>
<body data-theme = "" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/about/">
                        About
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/talks/">
                        Talks
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Influx-cli: a commandline interface to Influxdb.</h1>
                
                
                <div class="post-meta">
                    <time datetime="2014-09-08T08:36:36-04:00" itemprop="datePublished"> 8 Sep 2014 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p>
Time for another side project:
<a href="https://github.com/Dieterbe/influx-cli">influx-cli</a>,
a commandline interface to influxdb.
<br/>
Nothing groundbreaking, and it behaves pretty much as you would expect if you've ever used
the mysql, pgsql, vsql, etc tools before.
<br/>But I did want to highlight a few interesting features.
</p>

<br/>

<p>
<b>You can do things like user management via SQL,
even though influxdb doesn't have an SQL interface for this.</b>
<br/>This is much easier than doing curl http requests!
<pre>
influx> create admin test test
influx> list admin
## 0
                     name root
## 1
                     name test
</pre>
</p>

<p>
<b>You can change parameters and re-bind with the new values</b>
<pre>
influx> \user test
influx> \pass test
influx> \db graphite
influx> bind
</pre>
</p>

<p>
<b>Write your variables (user, pass, host, db, ...) to ~/.influxrc</b>
<pre>
influx> writerc
</pre>
</p>

<p>
<b>You can even do inserts via SQL, instead of http posts</b>
<br>I use this often.  This is very useful to script test cases for bug reports etc.
<pre>
influx> create db issue-1234
influx> \db issue-1234
influx> bind
influx> insert into demo (time, value, tag) values (120000, 10, "hi")
influx> insert into demo (time, value, tag) values (180000, 20, "hi again")
influx> select * from demo
## demo
                time sequence_number               value                 tag
       120000.000000      70001.000000                  10                "hi"
       180000.000000      80001.000000                  20          "hi again"
influx> delete db issue-1234
</pre>
</p>

<p>
<b>You can send queries on standard input, which is useful in shell commands and scripts.</b>
<pre>
$ echo 'list series' | influx-cli | wc -l
194722
$ influx-cli <<< 'list series' | wc -l
194722
</pre>
</p>

<p>
But even better, <b>from inside an influx-cli session, you can send output from any query into any other command.</b>
<br>In fact you can also <b>write output of queries into external files.</b>
All this via familiar shell constructs
<pre>
$ influx-cli
influx> list series | wc -l
194721
influx> list series > list-series.txt
</pre>

(note: the discrepancy of one line is due to <a href="https://github.com/shavac/readline/issues/2">the Go readline library echoing the query</a>.
</p>

<p>
<b>You can also toggle options, such as compression or display of timings.</b>
<br/>This can be very useful to easily get insights of performance of different operations.
<pre>
influx> \t
timing is now true
influx> select * from foo | wc -l
64637
timing>
query+network: 1.288792048s
displaying   : 457.091811ms
influx> \comp
compression is now disabled
influx> select * from foo | wc -l
64637
timing>
query+network: 969.322374ms
displaying   : 670.736018ms
influx> list series >/dev/null
timing>
query+network: 3.109178142s
displaying   : 65.712027ms
</pre>
<br/>This has enabled me to pinpoint slow operations and provide evidence when <a href="https://github.com/influxdb/influxdb/issues/884">when creating tickets</a>.
</p>

<p>
<b>Executing queries and debugging their result data format, works too</b>
<br/>This is useful when you want to understand the api better or if the database gets support for new queries with a different output format that influx-cli doesn't understand yet.
<pre>
influx> raw select * from foo limit 1
([]*client.Series) (len=1 cap=4) {
 (*client.Series)(0xc20b4f0480)({
  Name: (string) (len=51) "foo",
  Columns: ([]string) (len=3 cap=4) {
   (string) (len=4) "time",
   (string) (len=15) "sequence_number",
   (string) (len=5) "value"
  },
  Points: ([][]interface {}) (len=1 cap=4) {
   ([]interface {}) (len=3 cap=4) {
    (float64) 1.410148588e+12,
    (float64) 1,
    (float64) 95.549995
   }
  }
 })
}
</pre>
</p>

<p>
And that's about it.
I've found this to be a much easier way to interface with InfluxDB then using the web interface and curl, but YMMV.
<br/>If you were wondering, this is of course built on top of the <a href="https://github.com/influxdb/influxdb/tree/master/client">influxdb go client library</a>, which was overall pretty pleasant to work with.
<br/>Some ideas for future work:
<ul>
<li><a href="https://github.com/Dieterbe/influx-cli/issues/2">bulk insert performance could be better</a></li>
<li>once <a href="https://github.com/influxdb/influxdb/issues/263">influxdb can report query execution time</a> and hopefully also serialization time, the timing output can be more useful.  Right now we can only measure query execution+serialization+network transfer time combined</li>
<li>my gut feeling says that using something like msgpack instead of json, and/or even streaming the resultset as it is being generated (instead of first building the entire result, then serializing it, then sending it over, then having the client deserialize the entire thing) could really help performance, not just here, but basically anywhere you interface with influxdb.  Though I don't have hard numbers on this yet.</li>
</p>


            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/hugo-sid" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://twitter.com" target="_blank" rel="noopener noreferrer me"
    title="Twitter">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
</a>
<a href="index.xml" target="_blank" rel="noopener noreferrer me"
    title="Rss">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>
</a>
</div>
    <small class="footer_copyright">
        All content Â© Dieter Plaetinck, available under
        <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noreferrer noopener">CC BY 4.0</a>
    </small>

</footer>







    
    <script src="http://localhost:1313/js/main.min.4ee188e1744c19816e95a540b2650ed9f033ea0371e74eac8e717355cfca8741.js" integrity="sha256-TuGI4XRMGYFulaVAsmUO2fAz6gNx506sjnFzVc/Kh0E="></script>

    

</body>
</html>
